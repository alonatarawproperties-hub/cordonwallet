GOAL: WalletConnect inside BrowserWebViewScreen should auto-detect and pair when:
1) a dapp triggers a wc: / walletconnect: navigation
2) a dapp copies a wc URI via navigator.clipboard.writeText (Copy link button)
3) a dapp uses window.open with a wc: URI

CONSTRAINTS:
- Minimal changes, do NOT refactor other logic.
- Modify ONLY client/screens/BrowserWebViewScreen.tsx (unless COMBINED_INJECTED_SCRIPT is defined elsewhere — if so, modify the file where it is defined, but keep changes minimal).
- Do NOT break existing message types or navigation behavior.
- Because injectedJavaScript and injectedJavaScriptBeforeContentLoaded both run COMBINED_INJECTED_SCRIPT, add a guard so it runs only once.

========================================
A) BrowserWebViewScreen.tsx — add pairing helper
========================================
1) Import useWalletConnect if not already:
import { useWalletConnect } from "client/lib/walletconnect/context";  (adjust relative import if needed)

2) Inside the component:
const { connect } = useWalletConnect();

3) Add these helper functions inside the component (near other handlers):

function extractWcUri(input: string): string | null {
  if (!input) return null;
  let s = input.trim();

  // If it's a URL like https://...?uri=wc%3A.... or wc?uri=...
  try {
    if (s.startsWith("http://") || s.startsWith("https://")) {
      const u = new URL(s);
      const uriParam = u.searchParams.get("uri") || u.searchParams.get("wc");
      if (uriParam) s = uriParam;
    }
  } catch {}

  // Handle "wc?uri=..." fragments or "uri=wc%3A..."
  if (s.includes("uri=")) {
    const idx = s.indexOf("uri=");
    s = s.slice(idx + 4);
    // cut off extra params
    const amp = s.indexOf("&");
    if (amp !== -1) s = s.slice(0, amp);
  }

  // Decode if encoded
  try { s = decodeURIComponent(s); } catch {}

  // Some wallets use walletconnect: scheme; normalize to wc:
  if (s.startsWith("walletconnect:")) {
    s = "wc:" + s.slice("walletconnect:".length);
  }

  // Accept only wc:
  if (s.startsWith("wc:")) return s;

  // Sometimes the wc: appears inside a longer string
  const wcIndex = s.indexOf("wc:");
  if (wcIndex !== -1) {
    const candidate = s.slice(wcIndex);
    return candidate.startsWith("wc:") ? candidate : null;
  }

  return null;
}

async function tryPairWalletConnectUri(raw: string) {
  const uri = extractWcUri(raw);
  if (!uri) return;
  console.log("[BrowserWC] pairing", uri);
  try {
    await connect(uri);
  } catch (e) {
    console.log("[BrowserWC] connect failed", e);
  }
}

========================================
B) Update handleShouldStartLoad to intercept wc links
========================================
Your WebView already uses:
onShouldStartLoadWithRequest={handleShouldStartLoad}

Modify handleShouldStartLoad(req) to do this EARLY (before other logic), then fall through to existing behavior:

const url = req?.url || "";
if (
  url.startsWith("wc:") ||
  url.startsWith("walletconnect:") ||
  url.includes("uri=wc%3A") ||
  url.includes("uri=wc:") ||
  url.includes("wc?uri=")
) {
  tryPairWalletConnectUri(url);
  return false; // prevent webview from trying to navigate to wc:
}

Then keep the rest of the existing function unchanged.

========================================
C) Update handleWebViewMessage to accept WC_URI postMessages
========================================
Your WebView already uses:
onMessage={handleWebViewMessage}

Inside handleWebViewMessage(event), keep existing parsing, but add this safe block WITHOUT breaking other message types:

let dataStr = event?.nativeEvent?.data;
if (!dataStr) return;

try {
  const msg = JSON.parse(dataStr);
  if (msg && msg.type === "WC_URI" && typeof msg.uri === "string") {
    tryPairWalletConnectUri(msg.uri);
    return;
  }
} catch {
  // if not JSON, ignore and continue existing logic
}

Then continue existing behavior.

========================================
D) Modify COMBINED_INJECTED_SCRIPT to hook clipboard + window.open and guard double-run
========================================
Right now you set:
injectedJavaScript={COMBINED_INJECTED_SCRIPT}
injectedJavaScriptBeforeContentLoaded={COMBINED_INJECTED_SCRIPT}

So COMBINED_INJECTED_SCRIPT may run twice. Add a guard:

At the TOP of COMBINED_INJECTED_SCRIPT string, wrap your existing script content like:

(function(){
  if (window.__cordonWCInjected) return;
  window.__cordonWCInjected = true;

  function post(uri){
    try{ window.ReactNativeWebView.postMessage(JSON.stringify({type:"WC_URI", uri: uri})); }catch(e){}
  }

  // Hook clipboard writeText
  try{
    const clip = navigator.clipboard;
    if (clip && clip.writeText) {
      const orig = clip.writeText.bind(clip);
      clip.writeText = function(t){
        if (typeof t === "string" && t.includes("wc:")) post(t);
        return orig(t);
      };
    }
  }catch(e){}

  // Hook window.open
  try{
    const origOpen = window.open;
    window.open = function(u, name, specs){
      if (typeof u === "string" && (u.includes("wc:") || u.includes("walletconnect:") || u.includes("uri=wc"))) {
        post(u);
      }
      return origOpen.call(window, u, name, specs);
    };
  }catch(e){}

  // OPTIONAL: also detect anchor clicks pointing to wc:
  try{
    document.addEventListener("click", function(e){
      const a = e.target && (e.target.closest ? e.target.closest("a") : null);
      const href = a && a.getAttribute && a.getAttribute("href");
      if (href && (href.startsWith("wc:") || href.startsWith("walletconnect:") || href.includes("uri=wc"))) {
        post(href);
      }
    }, true);
  }catch(e){}

  // KEEP the rest of the existing COMBINED_INJECTED_SCRIPT content BELOW this block,
  // or merge it inside this IIFE, but DO NOT delete existing features.
})();

IMPORTANT: Do not remove any existing script behavior. Only add this guard + WC hooks.
If your COMBINED script is defined as a template literal, insert this at the start.
If it is composed from other strings, prepend this snippet.

========================================
E) Expected behavior to verify
========================================
1) Open OpenSea in Cordon browser.
2) Tap Connect -> WalletConnect -> Copy link.
Expected: console shows [BrowserWC] pairing wc:...
and your existing session approval sheet appears (BrowserConnectSheet).
3) Also test any dapp that triggers a wc: navigation; it should intercept and pair.