REPLIT AGENT PROMPT (single task, minimal-risk patch)

Goal:
Fix the “Wallet Firewall” so it correctly warns when sending DIAS (or any Solana token) that is NON-TRANSFERABLE / restricted (Token-2022 permanent delegate / transfer hook / non-transferable, etc.). Also make the firewall modal/bottom-sheet match our app theme.

Constraints (DO NOT BREAK EXISTING SEND):
- Do NOT change how the real transaction is built/signed/sent.
- Add a READ-ONLY analyzer that runs ONLY when user taps “Review Transaction”.
- If analysis fails or times out, the send flow must still work (fallback to existing firewall UI with “Unknown risk”).
- Keep code changes minimal and localized. Prefer adding new helper files over editing many existing files.
- No blocking crashes. Wrap analyzer in try/catch + timeout.

What to implement (Solana-only for now):
1) Create a new analyzer utility: client/lib/solana/transfer-analyzer.ts
   - Export: analyzeSolanaTransfer(params)
   - Params should include:
     - connection (or rpc url / existing solana client)
     - mintAddress
     - fromAddress
     - toAddress
     - amount (ui amount)
   - Return a normalized result:
     {
       riskLevel: "low" | "medium" | "high" | "blocked" | "unknown",
       warnings: Array<{ code: string, title: string, message: string }>,
       tokenStandard?: "spl-token" | "token-2022" | "unknown",
       flags: {
         isNonTransferable?: boolean,
         hasTransferHook?: boolean,
         hasPermanentDelegate?: boolean,
         hasFreezeAuthority?: boolean,
         hasTransferFee?: boolean,
         hasConfidentialTransfers?: boolean
       }
     }

2) How analyzer works (must be read-only):
   - Detect token program (Token Program vs Token-2022):
     - Use getAccountInfo on mint and read owner program id.
     - If owner == Tokenkeg... => spl-token
     - If owner == TokenzQd... (Token-2022) => token-2022
   - If Token-2022:
     - Parse mint extensions to detect at least these:
       - NonTransferable (if present => BLOCKED)
       - PermanentDelegate (warn)
       - TransferHook (warn/high risk because program-controlled transfers)
       - TransferFeeConfig (warn/caution)
       - ConfidentialTransfer (warn/caution)
     - If parsing extensions is hard, you may:
       - Use @solana/spl-token (token-2022 helpers) if already installed
       - OR do a safe fallback approach:
         - Attempt a “dry-run” / simulateTransaction of a transfer instruction with the same mint/from/to
         - If simulation logs contain errors indicating non-transferable / transfer hook / owner restriction => treat as BLOCKED or HIGH with specific warning text.
       - IMPORTANT: simulation must be optional and time-limited (2-3 seconds). If timeout => unknown.
   - If standard SPL token:
     - Keep existing checks (freeze authority, transfer fees if you already detect, etc.)
     - If you have no checks today, return low/unknown.

3) Wire analyzer into the existing “Review Transaction” flow for Solana sends:
   - Find where “Review Transaction” button triggers the firewall sheet/modal for send.
   - Before opening the firewall UI, call analyzer (Solana only) with:
     mint, from, to, amount
   - Use dynamic import to avoid bundle evaluation order issues:
     const { analyzeSolanaTransfer } = await import("../lib/solana/transfer-analyzer");
   - Show a small loading state while analyzing:
     - Button label: “Analyzing…”
     - Or inside firewall sheet show “Analyzing transaction…”
   - After analysis returns, render warnings in the firewall UI.
   - If riskLevel is "blocked":
     - Replace “Confirm Send” with disabled button + message:
       “This token is non-transferable / restricted. Only the permanent delegate can move it.”
     - Still allow “Cancel”.
   - If risk is high/medium:
     - Show prominent warning banner above summary.
   - If unknown:
     - Show “Couldn’t analyze token restrictions. Proceed with caution.”

4) Theme fix for firewall UI:
   - The firewall modal/bottom sheet must match our current theme (same as other sheets):
     - Use Themed components (ThemedText, theme.background, theme.card, theme.border, theme.accent, theme.textSecondary).
     - Ensure blur/backdrop, radius, spacing match WalletSwitcherSheet style (rounded, subtle borders).
     - No iOS “system alert” look.
   - Ensure typography and colors match: dark card, subtle border, accent button, consistent padding.

5) Output requirements:
   - Tell me EXACT files changed + short diff-style summary.
   - Add console logs only if necessary; remove noisy logs afterward.
   - Ensure sending DIAS now shows a warning like:
     - “Non-transferable token” / “Permanent delegate restriction detected”
     - and blocks confirm if appropriate.

6) Testing steps (must do and report results):
   - On mobile: attempt sending DIAS to another address:
     - Firewall should show restriction warning.
     - If non-transferable, Confirm should be disabled.
   - Try sending a normal SPL token (e.g., ROACHY):
     - Should still work; firewall shows low/normal.
   - If analyzer fails, send flow must still open firewall (unknown risk) and not crash.

Start now. Keep changes minimal and safe.